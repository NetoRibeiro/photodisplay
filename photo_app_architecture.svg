<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="900"><defs><style>
.box { fill: #f8f9fb; stroke: #c9d1e4; stroke-width: 1.5; rx: 14; ry: 14; }
.group { fill: #ffffff; stroke: #aab4c4; stroke-width: 1.8; rx: 20; ry: 20; }
.title { font-family: Arial, sans-serif; font-size: 20px; font-weight: bold; fill: #0f172a; }
.small { font-family: Arial, sans-serif; font-size: 14px; fill: #0f172a; }
.badge { font-family: Arial, sans-serif; font-size: 12px; fill: #334155; }
.link { stroke: #64748b; stroke-width: 2; marker-end: url(#arrow); fill: none; }
.dash { stroke-dasharray: 7 6; }
.note { font-family: Arial, sans-serif; font-size: 12px; fill: #475569; }
</style><marker id="arrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#64748b" /></marker></defs><g><rect x="40" y="40" width="380" height="220" class_="group" /><text x="54" y="68" class_="title">Clients (PWA UI)</text><text x="54" y="98" class_="small">• Smart TVs (WebOS/Tizen/Chromecast)</text><text x="54" y="120" class_="small">• Modern smartphones</text><text x="54" y="142" class_="small">• Older smartphones (ES5 + polyfills)</text><text x="54" y="164" class_="small">• Slideshow / Detail-only checkbox</text><text x="54" y="186" class_="small">• Low-bandwidth friendly</text></g><g><rect x="520" y="40" width="360" height="220" class_="group" /><text x="534" y="68" class_="title">CDN / Edge</text><text x="534" y="98" class_="small">• Serve static assets</text><text x="534" y="120" class_="small">• Cache thumbnails/variants</text><text x="534" y="142" class_="small">• Signed URL validation</text><text x="534" y="164" class_="small">• Device-appropriate formats (WebP/JPEG)</text></g><g><rect x="920" y="40" width="420" height="220" class_="group" /><text x="934" y="68" class_="title">Google Photos (Optional)</text><text x="934" y="98" class_="small">• OAuth 2.0 (read-only scope)</text><text x="934" y="120" class_="small">• Album paging &amp; rate limits</text><text x="934" y="142" class_="small">• Import selected media items</text></g><g><rect x="120" y="320" width="420" height="220" class_="group" /><text x="134" y="348" class_="title">API Gateway + Backend</text><text x="134" y="378" class_="small">• Auth (Google Sign-In)</text><text x="134" y="400" class_="small">• Uploads &amp; Imports</text><text x="134" y="422" class_="small">• Photo CRUD, notes (≤240 chars)</text><text x="134" y="444" class_="small">• Location override API (edit/revert)</text><text x="134" y="466" class_="small">• Signed media URLs</text><text x="134" y="488" class_="small">• SSE/WebSocket progress (optional)</text></g><g><rect x="600" y="320" width="360" height="220" class_="group" /><text x="614" y="348" class_="title">Database</text><text x="614" y="378" class_="small">• Photo records (EXIF, placeAuto/placeDisplay)</text><text x="614" y="400" class_="small">• Captions &amp; notes</text><text x="614" y="422" class_="small">• User settings</text><text x="614" y="444" class_="small">• Audit/provenance of overrides</text></g><g><rect x="1000" y="320" width="340" height="220" class_="group" /><text x="1014" y="348" class_="title">Object Storage</text><text x="1014" y="378" class_="small">• Originals</text><text x="1014" y="400" class_="small">• Variants (256/1024/2048)</text><text x="1014" y="422" class_="small">• Perceptual hash (dedupe)</text><text x="1014" y="444" class_="small">• Short-TTL signed URLs</text></g><g><rect x="200" y="600" width="980" height="240" class_="group" /><text x="214" y="628" class_="title">Background Workers &amp; Queue</text><text x="214" y="658" class_="small">• EXIF GPS parse (EXIF-only auto)</text><text x="214" y="680" class_="small">• Reverse geocoding (placeAuto)</text><text x="214" y="702" class_="small">• Derivatives (thumbnails/variants)</text><text x="214" y="724" class_="small">• AI caption (≤240 chars; safe prompt)</text><text x="214" y="746" class_="small">• Forward/reverse geocode for user overrides</text><text x="214" y="768" class_="small">• Status updates: processing → ready → error</text></g><g><rect x="140" y="360" width="180" height="150" class_="box" /><text x="152" y="384" class_="small">Auth &amp; Session</text><text x="152" y="408" class_="small">– Google OAuth</text><text x="152" y="428" class_="small">– Token exchange</text><text x="152" y="448" class_="small">– User scope</text></g><g><rect x="340" y="360" width="180" height="150" class_="box" /><text x="352" y="384" class_="small">Upload/Import API</text><text x="508" y="384" class_="badge" text-anchor="end">API</text><text x="352" y="408" class_="small">– Multipart uploads</text><text x="352" y="428" class_="small">– Google Photos import</text><text x="352" y="448" class_="small">– Rate limiting</text></g><g><rect x="620" y="360" width="160" height="150" class_="box" /><text x="632" y="384" class_="small">Photo Model</text><text x="632" y="408" class_="small">– exif.hasGps, lat/lon</text><text x="632" y="428" class_="small">– placeAuto, placeDisplay</text><text x="632" y="448" class_="small">– captionAi, noteUser</text></g><g><rect x="800" y="360" width="140" height="150" class_="box" /><text x="812" y="384" class_="small">Settings</text><text x="812" y="408" class_="small">– detailOnly</text><text x="812" y="428" class_="small">– slideshowIntervalSec</text></g><g><rect x="1020" y="360" width="140" height="150" class_="box" /><text x="1032" y="384" class_="small">Originals</text><text x="1032" y="408" class_="small">– /user/{id}/photos/...</text></g><g><rect x="1170" y="360" width="150" height="150" class_="box" /><text x="1182" y="384" class_="small">Variants</text><text x="1182" y="408" class_="small">– 256 / 1024 / 2048</text><text x="1182" y="428" class_="small">– WebP/JPEG</text></g><g><rect x="230" y="640" width="210" height="170" class_="box" /><text x="242" y="664" class_="small">EXIF Worker</text><text x="428" y="664" class_="badge" text-anchor="end">Job</text><text x="242" y="688" class_="small">– Parse GPS</text><text x="242" y="708" class_="small">– Set exif.hasGps</text><text x="242" y="728" class_="small">– Queue geocode</text></g><g><rect x="460" y="640" width="210" height="170" class_="box" /><text x="472" y="664" class_="small">Geocode Worker</text><text x="658" y="664" class_="badge" text-anchor="end">Job</text><text x="472" y="688" class_="small">– Reverse geocode</text><text x="472" y="708" class_="small">– Set placeAuto</text><text x="472" y="728" class_="small">– Update placeDisplay (if no override)</text></g><g><rect x="690" y="640" width="210" height="170" class_="box" /><text x="702" y="664" class_="small">Derivatives Worker</text><text x="888" y="664" class_="badge" text-anchor="end">Job</text><text x="702" y="688" class_="small">– Generate variants</text><text x="702" y="708" class_="small">– Perceptual hash</text><text x="702" y="728" class_="small">– CDN warmup</text></g><g><rect x="920" y="640" width="230" height="170" class_="box" /><text x="932" y="664" class_="small">AI Caption Worker</text><text x="1138" y="664" class_="badge" text-anchor="end">Job</text><text x="932" y="688" class_="small">– Vision model</text><text x="932" y="708" class_="small">– ≤240 chars</text><text x="932" y="728" class_="small">– Safe prompting</text></g><line x1="420" y1="150" x2="520" y2="150" class="link" /><line x1="280" y1="260" x2="280" y2="320" class="link" /><line x1="320" y1="320" x2="320" y2="260" class="link dash" /><line x1="540" y1="430" x2="600" y2="430" class="link" /><line x1="1040" y1="430" x2="1000" y2="430" class="link" /><line x1="330" y1="540" x2="330" y2="600" class="link" /><line x1="480" y1="600" x2="480" y2="540" class="link" /><line x1="690" y1="600" x2="690" y2="540" class="link" /><line x1="1035" y1="600" x2="1035" y2="540" class="link" /><line x1="920" y1="260" x2="540" y2="380" class="link" /><line x1="540" y1="400" x2="920" y2="260" class="link dash" /><line x1="700" y1="260" x2="320" y2="320" class="link" /><g><rect x="40" y="810" width="620" height="70" class_="group" /><text x="54" y="838" class_="title">Legend</text><text x="54" y="868" class_="small">• Solid arrow: request/flow</text><text x="54" y="890" class_="small">• Dashed arrow: streaming/async/provenance</text><text x="54" y="912" class_="small">• Badges: API/Job roles</text></g><text x="40" y="770" class_="note">Automatic location derives only from EXIF GPS → reverse geocoding. User overrides change display only; EXIF remains intact.</text></svg>